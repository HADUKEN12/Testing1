<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8"/>

  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>

  <title>OT Records Data</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>

    /* Improved navbar styling */
    .navbar {
      display: none; /* Initially hidden */
      position: fixed;
      top: 0;
      left: 0;
      background-color: white;
      border-right: 1px solid #e5e7eb;
      height: 100%;
      width: 250px;
      z-index: 1000;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
      padding: 1.5rem 0;
      overflow-y: auto;
    }

    .navbar.active {
      display: block; /* Show when active */
    }

    .navbar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .navbar li {
      margin-bottom: 0.5rem;
    }

    .navbar a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1.5rem;
      color: #4b5563;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .navbar a:hover {
      background-color: #f3f4f6;
      color: #10b981;
    }

    .navbar a.active {
      background-color: #f0fdf4;
      color: #10b981;
      border-left: 3px solid #10b981;
    }

    .navbar a svg {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .toggle-btn {
      cursor: pointer;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      background-color: white;
      border-radius: 0.375rem;
      padding: 0.5rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .toggle-btn:hover {
      background-color: #f3f4f6;
    }

    /* Logout link special styling */
    .navbar .logout-link {
      color: #ef4444;
      border-top: 1px solid #e5e7eb;
      margin-top: 1rem;
      padding-top: 1rem;
    }

    .navbar .logout-link:hover {
      background-color: #fef2f2;
    }

    /* Settings button styling */
    .setting-item {
      padding: 0.75rem 1.5rem;
      border-top: 1px solid #e5e7eb;
      margin-top: 1rem;
    }

    .settings-btn {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      color: #4b5563;
      cursor: pointer;
      padding: 0;
      font-size: 0.875rem;
      width: 100%;
      text-align: left;
    }

    .settings-btn:hover {
      color: #10b981;
    }

    .settings-btn i {
      margin-right: 12px;
    }

    /* Add margin to the main content when navbar is active */
    .max-w-7xl {
      transition: margin-left 0.3s ease;
    }

    .max-w-7xl.shifted {
      margin-left: 250px;
    }

    /* Add some top padding to the main content */
    .content-wrapper {
      padding-top: 1rem;
    }

    @media (max-width: 768px) {
      .max-w-7xl.shifted {
        margin-left: 0;
      }
    }

    /* Updated resizable table styles */
    .resizable-table {
      table-layout: fixed;
      width: 100%;
    }

    .resizable-table th {
      position: relative;
      min-width: 50px;
      white-space: nowrap;
      padding: 8px 20px 8px 8px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .resizable-table td {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 8px;
      transition: width 0.2s ease;
    }

    .resize-handle {
      position: absolute;
      right: 0;
      top: 0;
      height: 100%;
      width: 8px;
      cursor: col-resize;
      background-color: #ddd;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .resize-handle:hover,
    .resize-handle.active {
      opacity: 1;
      background-color: #999;
    }

    .resize-active {
      cursor: col-resize !important;
      user-select: none;
    }
    

  </style>

</head>

<body class="bg-gray-100 p-8">

  <div class="toggle-btn" onclick="toggleNavbar()">

    <img src="./navigation.png" alt="Menu Icon" style="width: 20px; height: 20px;"/>

  </div>

  

  <nav class="navbar" id="navbar">
    <ul>
        <li>
            <a href="dashhr.html">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                </svg>
                Dashboard
            </a>
        </li>
        <li>
            <a href="#" onclick="goToProfilePage()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                Profile
            </a>
        </li>
        <li>
            <a href="otrecording.html">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Recording
            </a>
        </li>
        <li>
            <a href="appforleave.html">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                For Leave
            </a>
        </li>
        <li>
            <a href="data.html" class="active">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Data
            </a>
        </li>
        <li>
            <a href="dataforleave.html">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                For Leave Data
            </a>
        </li>
        <li>
            <a href="#" onclick="logout()" class="logout-link">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                Logout
            </a>
        </li>
    </ul>
    
  </nav>

  <div class="max-w-7xl mx-auto content-wrapper" id="mainContent">
    <h1 class="text-2xl font-bold mb-4">Overtime Records</h1>
    
    <!-- Add bulk actions toolbar -->
    <div class="bg-white rounded-lg shadow p-4 mb-4 flex flex-col sm:flex-row gap-3 items-center">
        <div class="flex-grow flex gap-3">
            <select id="bulkAction" class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                <option value="">Bulk Actions</option>
                <option value="approve">Approve Selected</option>
                <option value="disapprove">Disapprove Selected</option>
                <option value="delete">Delete Selected</option>
            </select>
            <button onclick="applyBulkAction()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Apply
            </button>
        </div>
        <!-- Updated search bar and filters without buttons -->
        <div class="bg-white rounded-lg shadow p-4 mb-4 flex flex-col sm:flex-row gap-3">
          <div class="flex-grow">
            <input type="text" id="searchInput" placeholder="Search records..." 
              class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
          </div>
          <div class="w-full sm:w-48">
            <select id="searchCriteria" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
              <option value="all">All Fields</option>
              <option value="employeeNo">Employee No</option>
              <option value="employeeName">Name</option>
              <option value="department">Department</option>
              <option value="date">Date</option>
              <option value="status">Status</option>
            </select>
          </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow overflow-x-auto">
        <table class="min-w-full resizable-table">
            <thead class="bg-gray-50" id="tableHeader">
                <!-- Table headers will be dynamically inserted here -->
            </thead>
            <tbody id="otRecordsBody">
                <!-- Records will be inserted here -->
            </tbody>
        </table>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import { getDatabase, ref, get, remove, update } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-database.js";

    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDzNOjp4SXZSL5z6A35pxNU34Ts67pGlwM",
        authDomain: "logintesting-64bd1.firebaseapp.com",
        databaseURL: "https://logintesting-64bd1-default-rtdb.firebaseio.com",
        projectId: "logintesting-64bd1",
        storageBucket: "logintesting-64bd1.appspot.com",
        messagingSenderId: "1065274423800",
        appId: "1:1065274423800:web:d2e62d59aa94032546be0d"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Make functions globally available
    window.displayOTRecords = displayOTRecords;
    window.deleteRecord = deleteRecord;
    window.updateStatus = updateStatus;
    window.toggleNavbar = toggleNavbar;
    window.goToProfilePage = goToProfilePage;
    window.logout = logout;
    window.editGeneralSettings = editGeneralSettings;
    window.searchRecords = searchRecords;

    // Updated user role checking function
    function checkUserRole() {
        const userData = JSON.parse(sessionStorage.getItem('userData') || '{}');
        return {
            isAdmin: userData.isAdmin === true,
            isHR: userData.role === 'hr' || userData.signupSource === 'hr-signup',  // Check both role and signupSource
            isRegularUser: userData.role === 'user' || userData.signupSource === 'create-signup',
            // Give full access to both admin and HR
            hasFullAccess: userData.department === 'Admin' || 
                          userData.role === 'hr' || 
                          userData.signupSource === 'hr-signup'
        };
    }

    // Updated displayOTRecords function
    async function displayOTRecords(searchTerm = "", searchCriteria = "all") {
        const tbody = document.getElementById('otRecordsBody');
        const thead = document.getElementById('tableHeader');
        
        try {
            const userRole = checkUserRole();
            const recordsRef = ref(database, 'otRecords');
            const snapshot = await get(recordsRef);
            
            // Define column configurations
            const fullColumns = [
                'Select',
                'Employee No',
                'Name',
                'Department',
                'Date',
                'Schedule',
                'OT Start',
                'OT End',
                'Total Hours',
                'OT Type',
                'Reason',
                'Status',
                'Actions'
            ];

            const regularUserColumns = [
                'Employee No',
                'Name',
                'Total Hours',
                'Status',
            ];

            // Use full columns for both Admin and HR
            const columns = userRole.hasFullAccess ? fullColumns : regularUserColumns;

            // Create header row
            const headerRow = document.createElement('tr');
            columns.forEach(column => {
                const th = document.createElement('th');
                th.className = 'px-4 py-2 border';
                
                if (column === 'Select' && userRole.hasFullAccess) {
                    // Add "Select All" checkbox
                    const selectAllCheckbox = document.createElement('input');
                    selectAllCheckbox.type = 'checkbox';
                    selectAllCheckbox.className = 'form-checkbox h-4 w-4 text-green-600';
                    selectAllCheckbox.onclick = () => {
                        const checkboxes = document.querySelectorAll('input[name="recordCheckbox"]');
                        checkboxes.forEach(cb => cb.checked = selectAllCheckbox.checked);
                    };
                    th.appendChild(selectAllCheckbox);
                } else {
                    th.textContent = column;
                }
                
                const resizeHandle = document.createElement('div');
                resizeHandle.className = 'resize-handle';
                th.appendChild(resizeHandle);
                headerRow.appendChild(th);
            });
            thead.innerHTML = '';
            thead.appendChild(headerRow);

            if (!snapshot.exists()) {
                tbody.innerHTML = `<tr><td colspan="${columns.length}" class="text-center py-4">No records found</td></tr>`;
                return;
            }

            // Convert snapshot to array and filter based on search term
            let records = [];
            snapshot.forEach((childSnapshot) => {
                records.push({
                    id: childSnapshot.key,
                    ...childSnapshot.val()
                });
            });
            
            // Apply search filter if provided
            if (searchTerm) {
                searchTerm = searchTerm.toLowerCase();
                records = records.filter(record => {
                    if (searchCriteria === "all") {
                        // Search in all fields
                        return Object.values(record).some(value => 
                            value && value.toString().toLowerCase().includes(searchTerm)
                        );
                    } else if (searchCriteria === "date") {
                        // Special handling for date fields
                        const recordDate = new Date(record.date).toLocaleDateString().toLowerCase();
                        return recordDate.includes(searchTerm);
                    } else {
                        // Search in specific field
                        return record[searchCriteria] && 
                              record[searchCriteria].toString().toLowerCase().includes(searchTerm);
                    }
                });
            }
            
            // Sort by date (newest first)
            records.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Clear existing content
            tbody.innerHTML = '';

            if (records.length === 0) {
                tbody.innerHTML = `<tr><td colspan="${columns.length}" class="text-center py-4">No matching records found</td></tr>`;
                return;
            }

            // Add each record to the table
            records.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                if (userRole.hasFullAccess) {
                    // Admin and HR view - show all columns with edit/delete capabilities
                    // Add checkbox first
                    const checkboxCell = document.createElement('td');
                    checkboxCell.className = 'px-4 py-2 border';
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'recordCheckbox';
                    checkbox.value = record.id;
                    checkbox.className = 'form-checkbox h-4 w-4 text-green-600';
                    checkboxCell.appendChild(checkbox);
                    row.appendChild(checkboxCell);

                    // Add other cells
                    const cells = [
                        record.employeeNo,
                        record.employeeName,
                        record.department,
                        new Date(record.date).toLocaleDateString(),
                        record.schedule,
                        record.otStart,
                        record.otEnd,
                        record.totalHours,
                        record.otType,
                        record.reason,
                    ];

                    cells.forEach(cellData => {
                        const td = document.createElement('td');
                        td.className = 'px-4 py-2 border';
                        td.textContent = cellData || '';
                        row.appendChild(td);
                    });

                    // Add status dropdown
                    const statusCell = document.createElement('td');
                    statusCell.className = 'px-4 py-2 border';
                    const statusSelect = document.createElement('select');
                    statusSelect.className = 'w-full p-1 border rounded';
                    ['Pending', 'Approved', 'Disapproved'].forEach(status => {
                        const option = document.createElement('option');
                        option.value = status;
                        option.textContent = status;
                        option.selected = record.status === status;
                        statusSelect.appendChild(option);
                    });
                    statusSelect.onchange = () => updateStatus(record.id, statusSelect.value);
                    statusCell.appendChild(statusSelect);
                    row.appendChild(statusCell);

                    // Add action buttons
                    const actionCell = document.createElement('td');
                    actionCell.className = 'px-4 py-2 border';
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 mr-2';
                    deleteButton.textContent = 'Delete';
                    deleteButton.onclick = () => deleteRecord(record.id);
                    actionCell.appendChild(deleteButton);
                    row.appendChild(actionCell);
                } else {
                    // Regular user view - limited columns
                    const cells = [
                        record.employeeNo,
                        record.employeeName,
                        record.totalHours,
                        record.status
                    ];

                    cells.forEach(cellData => {
                        const td = document.createElement('td');
                        td.className = 'px-4 py-2 border';
                        td.textContent = cellData || '';
                        row.appendChild(td);
                    });
                }

                tbody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching records:', error);
            tbody.innerHTML = `<tr><td colspan="${columns.length}" class="text-center py-4 text-red-500">Error loading records: ${error.message}</td></tr>`;
        }
    }

   
    function searchRecords() {
        try {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const searchCriteria = document.getElementById('searchCriteria').value;
            displayOTRecords(searchTerm, searchCriteria);
        } catch (error) {
            console.error('Error in search function:', error);
        }
    }

    // Improved debounce function with error handling
    function debounce(func, timeout = 300) {
        let timer;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => {
                try {
                    func.apply(this, args);
                } catch (error) {
                    console.error('Error in debounced function:', error);
                }
            }, timeout);
        };
    }

    // Create debounced search function
    const debouncedSearch = debounce(searchRecords);

    // Initialize the display when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        try {
            displayOTRecords();
            
            // Make sure these functions exist before calling them
            if (typeof initializeResizableTable === 'function') {
                initializeResizableTable();
            }
            
            if (typeof setActivePage === 'function') {
                setActivePage();
            }
            
            // Add event listeners for automatic search
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debouncedSearch);
            }
            
            const searchCriteria = document.getElementById('searchCriteria');
            if (searchCriteria) {
                searchCriteria.addEventListener('change', debouncedSearch);
            }
            
            // Add ESC key listener to clear search
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && searchInput) {
                    searchInput.value = '';
                    if (searchCriteria) {
                        searchCriteria.value = 'all';
                    }
                    displayOTRecords();
                }
            });
            
            // Close navbar when clicking outside on mobile devices
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768) {
                    const navbar = document.getElementById('navbar');
                    const toggleBtn = document.querySelector('.toggle-btn');
                    
                    if (navbar.classList.contains('active') && 
                        !navbar.contains(event.target) && 
                        !toggleBtn.contains(event.target)) {
                        toggleNavbar();
                    }
                }
            });
        } catch (error) {
            console.error('Error in initialization:', error);
        }
    });

    function toggleNavbar() {
        const navbar = document.getElementById('navbar');
        const mainContent = document.getElementById('mainContent');
        navbar.classList.toggle('active');
        
        // Only adjust the main content on larger screens
        if (window.innerWidth > 768) {
            mainContent.classList.toggle('shifted');
        }
    }

    function goToProfilePage() {
        const userId = sessionStorage.getItem('userID');
        if (userId) {
            window.location.href = `profile.html?userId=${userId}`;
        } else {
            alert('Please login first');
            window.location.href = 'login.html';
        }
    }

    function logout() {
        sessionStorage.removeItem('userID');
        sessionStorage.removeItem('userData');
        window.location.href = 'login.html';
    }

    async function deleteRecord(id) {
        const userRole = checkUserRole();
        if (!userRole.hasFullAccess) {
            alert('Only administrators and HR personnel can delete records');
            return;
        }

        if (confirm('Are you sure you want to delete this record?')) {
            try {
                const recordsRef = ref(database, 'otRecords/' + id);
                await remove(recordsRef);
                displayOTRecords(); // Refresh the table
                alert('Record deleted successfully!');
            } catch (error) {
                console.error('Error deleting record:', error);
                alert('Error deleting record. Please try again.');
            }
        }
    }

    async function updateStatus(id, newStatus) {
        const userRole = checkUserRole();
        if (!userRole.hasFullAccess) {
            alert('Only administrators and HR personnel can update status');
            return;
        }

        try {
            const recordsRef = ref(database, 'otRecords/' + id);
            await update(recordsRef, { status: newStatus });
            alert('Status updated successfully!');
        } catch (error) {
            console.error('Error updating status:', error);
            alert('Error updating status. Please try again.');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const table = document.querySelector('.resizable-table');
      const headers = table.querySelectorAll('th');
      let currentHeader = null;
      let isResizing = false;

      function autoFitColumns() {
        // Temporarily set table-layout to auto for content-based sizing
        table.style.tableLayout = 'auto';
        
        headers.forEach(header => {
          // Reset width to auto first
          header.style.width = 'auto';
          
          const headerIndex = Array.from(headers).indexOf(header);
          const cells = table.querySelectorAll(`td:nth-child(${headerIndex + 1})`);
          let maxWidth = header.getBoundingClientRect().width;
          
          // Find maximum content width
          cells.forEach(cell => {
            const cellWidth = cell.getBoundingClientRect().width;
            maxWidth = Math.max(maxWidth, cellWidth);
          });
          
          // Add some padding to the width
          header.style.width = `${maxWidth + 24}px`;
        });
        
        // Switch back to fixed layout after sizing
        table.style.tableLayout = 'fixed';
      }

      // Call autoFitColumns after the table content is loaded
      setTimeout(autoFitColumns, 0);

      // Add resize handles
      headers.forEach(header => {
        const resizeHandle = document.createElement('div');
        resizeHandle.className = 'resize-handle';
        header.appendChild(resizeHandle);
        resizeHandle.addEventListener('mousedown', startResizing);
      });

      function startResizing(e) {
        isResizing = true;
        currentHeader = e.target.parentElement;
        const startX = e.pageX;
        const startWidth = currentHeader.offsetWidth;

        document.body.classList.add('resize-active');

        function onMouseMove(e) {
          if (!isResizing) return;
          const diff = e.pageX - startX;
          const newWidth = Math.max(50, startWidth + diff);
          currentHeader.style.width = `${newWidth}px`;
        }

        function onMouseUp() {
          if (!isResizing) return;
          isResizing = false;
          document.body.classList.remove('resize-active');
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
        }

        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      }

      // Auto-fit columns when window is resized
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
          table.style.tableLayout = 'auto';
          autoFitColumns();
        }, 250);
      });
    });

    // Add this function to highlight the active page in navbar
    function setActivePage() {
        // Get current page URL
        const currentPath = window.location.pathname;
        const currentPage = currentPath.substring(currentPath.lastIndexOf('/') + 1);
        
        // Find all links in navbar
        const navLinks = document.querySelectorAll('.navbar a');
        
        // Remove active class from all links
        navLinks.forEach(link => {
            link.classList.remove('active');
        });
        
        // Add active class to current page link
        navLinks.forEach(link => {
            const href = link.getAttribute('href');
            if (href === currentPage) {
                link.classList.add('active');
            }
        });
    }

    // General Settings function
    function editGeneralSettings() {
        alert('General settings feature will be coming soon!');
    }

    // Add bulk action function
    async function applyBulkAction() {
        const userRole = checkUserRole();
        if (!userRole.hasFullAccess) {
            alert('Only administrators and HR personnel can perform bulk actions');
            return;
        }

        const action = document.getElementById('bulkAction').value;
        if (!action) {
            alert('Please select an action');
            return;
        }

        const checkboxes = document.querySelectorAll('input[name="recordCheckbox"]:checked');
        if (checkboxes.length === 0) {
            alert('Please select at least one record');
            return;
        }

        if (!confirm(`Are you sure you want to ${action} ${checkboxes.length} selected records?`)) {
            return;
        }

        try {
            const updates = {};
            for (const checkbox of checkboxes) {
                const recordId = checkbox.value;
                if (action === 'delete') {
                    updates[`otRecords/${recordId}`] = null;
                } else {
                    const newStatus = action === 'approve' ? 'Approved' : 'Disapproved';
                    updates[`otRecords/${recordId}/status`] = newStatus;
                }
            }

            await update(ref(database), updates);
            alert('Bulk action completed successfully!');
            displayOTRecords(); // Refresh the table
        } catch (error) {
            console.error('Error performing bulk action:', error);
            alert('Error performing bulk action. Please try again.');
        }
    }
  </script>

</body>

</html>


